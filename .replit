entrypoint = "."

run = "npm install --no-fund --no-audit && npm run dev"

[nix]
channel = "stable-23_11"

[[ports]]
localPort = 5000
externalPort = 80

[gitHubImport]
requiredFiles = [".replit", "replit.nix", "package.json", "package-lock.json"]

[deployment]
run = ["bash", "-lc", "npm ci && npm run build && npm start"]

[workflows.install]
name = "Install Dependencies"
mode = "sequential"

  [[workflows.install.tasks]]
  type = "install-packages"

  [[workflows.install.tasks]]
  type = "execute-shell-command"
  command = "npm run build:backend"

[workflows.build]
name = "Build Application"
mode = "sequential"

  [[workflows.build.tasks]]
  type = "execute-shell-command"
  command = "npm run build"

[workflows.test]
name = "Run Tests"
mode = "sequential"

  [[workflows.test.tasks]]
  type = "execute-shell-command"
  command = "npm run test:backend"

[workflows.dev]
name = "Development Server"
mode = "sequential"

  [[workflows.dev.tasks]]
  type = "run-workflow"
  workflow = "install"

  [[workflows.dev.tasks]]
  type = "execute-shell-command"
  command = "npm run dev:backend"

[workflows.full-deploy]
name = "Full Deployment Pipeline"
mode = "sequential"

  [[workflows.full-deploy.tasks]]
  type = "run-workflow"
  workflow = "install"

  [[workflows.full-deploy.tasks]]
  type = "run-workflow"
  workflow = "test"

  [[workflows.full-deploy.tasks]]
  type = "run-workflow"
  workflow = "build"

  [[workflows.full-deploy.tasks]]
  type = "execute-shell-command"
  command = "curl -f http://localhost:5000/health || exit 1"
